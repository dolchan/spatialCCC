---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# spatialCCC

<!-- badges: start -->
<!-- badges: end -->

The goal of spatialCCC is to investigate cell-cell signaling, by analyzing ligand-receptor interactions in spatial transcriptomic data.

## Installation

You can install the development version of spatialCCC from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("dolchan/spatialCCC")
```

## Example

This is a basic example which shows you how to solve a common problem:

```{r message = FALSE}
library(SpatialExperiment)
library(scater)
library(dplyr)
library(tidyr)
library(magrittr)
library(purrr)
library(ggplot2)
library(patchwork)

library(ggraph)
library(tidygraph)
library(RColorBrewer)
```

```{r example}
library(spatialCCC)
## basic example code
```

## Example: Visium Spatial Transcriptomic Data
```{r}
data_dir <- file.path("example", "visium_tutorial")
spe <- SpatialExperiment::read10xVisium(samples = data_dir, type = "HDF5", data = "filtered")
```

## Ligand-Receptor Database: built-in
```{r}
LRdb_mouse <- 
  get_LRdb("mouse") %>%
  dplyr::slice_sample(n = 50)
```

## Log-Normalize
```{r}
spe <- logNormCounts(spe)
```

## Compute Cell-Cell Communications over ligand-receptor pairs
```{r}
# For full LRdb analysis, future::plan can be used 
#   for parallelization
# future::plan(future::multisession, workers = 4)

tictoc::tic()
ccc_tbl <- compute_spatial_ccc(spe = spe, 
                               assay_name = "logcounts",
                               LRdb = LRdb_mouse)
tictoc::toc()

# future::plan(future::sequential)
```


```{r}
ccc_tbl %>% 
  dplyr::arrange(desc(LRscore))
```


```{r}
tictoc::tic("to_spatical_ccc_graph ...")

sp_col_data <- get_spatial_coords(spe)

ccc_graph_list <-
  to_spatial_ccc_graph_list(ccc_tbl, sp_col_data, workers = 4)

tictoc::toc()
```


```{r}
tictoc::tic()

ccc_graph_metrics_summary_df <-
  summarize_ccc_graph_metrics(ccc_graph_list)

tictoc::toc()
```


```{r}
ccc_graph_metrics_summary_df 
```


```{r}
tictoc::tic()

ccc_graph_group_metrics_summary_df <-
  summarize_ccc_graph_metrics(ccc_graph_list, level = "group")

tictoc::toc()
```


```{r}
ccc_graph_group_metrics_summary_df 
```
